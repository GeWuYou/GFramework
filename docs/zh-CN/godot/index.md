# GFramework.Godot

> Godot å¼•æ“æ·±åº¦é›†æˆ - ä¸º GFramework æ¡†æ¶æä¾›åŸç”Ÿçš„ Godot æ”¯æŒ

GFramework.Godot æ˜¯ GFramework æ¡†æ¶çš„ Godot ç‰¹å®šå®ç°ï¼Œå°†æ¡†æ¶çš„æ¶æ„ä¼˜åŠ¿ä¸ Godot å¼•æ“çš„å¼ºå¤§åŠŸèƒ½å®Œç¾ç»“åˆã€‚

## ğŸ“‹ ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
- [æ¶æ„é›†æˆ](#æ¶æ„é›†æˆ)
- [Node æ‰©å±•æ–¹æ³•](#node-æ‰©å±•æ–¹æ³•)
- [ä¿¡å·ç³»ç»Ÿ](#ä¿¡å·ç³»ç»Ÿ)
- [èŠ‚ç‚¹æ± åŒ–](#èŠ‚ç‚¹æ± åŒ–)
- [èµ„æºç®¡ç†](#èµ„æºç®¡ç†)
- [æ—¥å¿—ç³»ç»Ÿ](#æ—¥å¿—ç³»ç»Ÿ)
- [å®Œæ•´ç¤ºä¾‹](#å®Œæ•´ç¤ºä¾‹)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [æ€§èƒ½ç‰¹æ€§](#æ€§èƒ½ç‰¹æ€§)

## æ¦‚è¿°

GFramework.Godot æä¾›äº†ä¸ Godot å¼•æ“çš„æ·±åº¦é›†æˆï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿåœ¨ä¿æŒ GFramework æ¶æ„ä¼˜åŠ¿çš„åŒæ—¶ï¼Œå……åˆ†åˆ©ç”¨ Godot
çš„èŠ‚ç‚¹ç³»ç»Ÿã€ä¿¡å·æœºåˆ¶å’Œåœºæ™¯ç®¡ç†åŠŸèƒ½ã€‚

### æ ¸å¿ƒè®¾è®¡ç†å¿µ

- **æ— ç¼é›†æˆ**ï¼šæ¡†æ¶ç”Ÿå‘½å‘¨æœŸä¸ Godot èŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸè‡ªåŠ¨åŒæ­¥
- **ç±»å‹å®‰å…¨**ï¼šä¿æŒ GFramework çš„å¼ºç±»å‹ç‰¹æ€§
- **æ€§èƒ½ä¼˜åŒ–**ï¼šé›¶é¢å¤–å¼€é”€çš„ Godot é›†æˆ
- **å¼€å‘æ•ˆç‡**ï¼šä¸°å¯Œçš„æ‰©å±•æ–¹æ³•ç®€åŒ–å¸¸è§æ“ä½œ

## æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ æ¶æ„ç”Ÿå‘½å‘¨æœŸç»‘å®š

- è‡ªåŠ¨å°†æ¡†æ¶åˆå§‹åŒ–ä¸ Godot åœºæ™¯æ ‘ç»‘å®š
- æ”¯æŒèŠ‚ç‚¹é”€æ¯æ—¶çš„è‡ªåŠ¨æ¸…ç†
- é˜¶æ®µå¼æ¶æ„åˆå§‹åŒ–ä¸ Godot `_Ready` å‘¨æœŸåŒæ­¥

### ğŸ”§ ä¸°å¯Œçš„ Node æ‰©å±•æ–¹æ³•

- **50+** ä¸ªå®ç”¨æ‰©å±•æ–¹æ³•
- å®‰å…¨çš„èŠ‚ç‚¹æ“ä½œå’ŒéªŒè¯
- æµç•…çš„åœºæ™¯æ ‘éå†å’ŒæŸ¥æ‰¾
- ç®€åŒ–çš„è¾“å…¥å¤„ç†

### ğŸ“¡ æµç•…çš„ä¿¡å· API

- ç±»å‹å®‰å…¨çš„ä¿¡å·è¿æ¥
- é“¾å¼è°ƒç”¨æ”¯æŒ
- è‡ªåŠ¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
- Godot ä¿¡å·ä¸æ¡†æ¶äº‹ä»¶ç³»ç»Ÿçš„æ¡¥æ¥

### ğŸŠâ€â™‚ï¸ é«˜æ•ˆçš„èŠ‚ç‚¹æ± åŒ–

- ä¸“ç”¨çš„ Node å¯¹è±¡æ± 
- è‡ªåŠ¨å›æ”¶å’Œé‡ç”¨æœºåˆ¶
- å†…å­˜å‹å¥½çš„é«˜é¢‘èŠ‚ç‚¹åˆ›å»º/é”€æ¯

### ğŸ“¦ æ™ºèƒ½èµ„æºç®¡ç†

- ç®€åŒ–çš„ Godot èµ„æºåŠ è½½
- ç±»å‹å®‰å…¨çš„èµ„æºå·¥å‚
- ç¼“å­˜å’Œé¢„åŠ è½½æ”¯æŒ

### ğŸ“ Godot åŸç”Ÿæ—¥å¿—

- ä¸ Godot æ—¥å¿—ç³»ç»Ÿå®Œå…¨é›†æˆ
- æ¡†æ¶æ—¥å¿—è‡ªåŠ¨è¾“å‡ºåˆ° Godot æ§åˆ¶å°
- å¯é…ç½®çš„æ—¥å¿—çº§åˆ«

## æ¶æ„é›†æˆ

### Architecture åŸºç±»

```csharp
using GFramework.Godot.architecture;

public class GameArchitecture : AbstractArchitecture
{
    protected override void Init()
    {
        // æ³¨å†Œæ ¸å¿ƒæ¨¡å‹
        RegisterModel(new PlayerModel());
        RegisterModel(new GameModel());
        
        // æ³¨å†Œç³»ç»Ÿ
        RegisterSystem(new CombatSystem());
        RegisterSystem(new AudioSystem());
        
        // æ³¨å†Œå·¥å…·ç±»
        RegisterUtility(new StorageUtility());
        RegisterUtility(new ResourceLoadUtility());
    }
    
    protected override void InstallModules()
    {
        // å®‰è£… Godot ç‰¹å®šæ¨¡å—
        InstallGodotModule(new InputModule());
        InstallGodotModule(new AudioModule());
    }
}
```

### Godot æ¨¡å—ç³»ç»Ÿ

```csharp
using GFramework.Godot.architecture;

[ContextAware]
[Log]
public partial class AudioModule : AbstractGodotModule
{
    // æ¨¡å—èŠ‚ç‚¹æœ¬èº«å¯ä»¥ä½œä¸º Godot èŠ‚ç‚¹
    public override Node Node => this;
    
    public override void Install(IArchitecture architecture)
    {
        // æ³¨å†ŒéŸ³é¢‘ç›¸å…³ç³»ç»Ÿ
        architecture.RegisterSystem(new AudioSystem());
        architecture.RegisterUtility(new AudioUtility());
    }
    
    public override void OnAttach(Architecture architecture)
    {
        // æ¨¡å—é™„åŠ æ—¶çš„åˆå§‹åŒ–
        Logger.Info("Audio module attached to architecture");
    }
    
    public override void OnDetach(Architecture architecture)
    {
        // æ¨¡å—åˆ†ç¦»æ—¶çš„æ¸…ç†
        Logger.Info("Audio module detached from architecture");
    }
    
    // å“åº”æ¶æ„ç”Ÿå‘½å‘¨æœŸé˜¶æ®µ
    public override void OnPhase(ArchitecturePhase phase, IArchitecture architecture)
    {
        switch (phase)
        {
            case ArchitecturePhase.Ready:
                // æ¶æ„å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹æ’­æ”¾èƒŒæ™¯éŸ³ä¹
                PlayBackgroundMusic();
                break;
        }
    }
}
```

### Controller é›†æˆ

```csharp
using GFramework.Godot.extensions;

[ContextAware]
[Log]
public partial class PlayerController : Node, IController
{
    private PlayerModel _playerModel;
    
    public override void _Ready()
    {
        // è·å–æ¨¡å‹å¼•ç”¨
        _playerModel = Context.GetModel<PlayerModel>();
        
        // æ³¨å†Œäº‹ä»¶ç›‘å¬ï¼Œè‡ªåŠ¨ä¸èŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸç»‘å®š
        this.RegisterEvent<PlayerInputEvent>(OnPlayerInput)
            .UnRegisterWhenNodeExitTree(this);
            
        // ç›‘å¬å±æ€§å˜åŒ–
        _playerModel.Health.Register(OnHealthChanged)
            .UnRegisterWhenNodeExitTree(this);
    }
    
    private void OnPlayerInput(PlayerInputEvent e)
    {
        // å¤„ç†ç©å®¶è¾“å…¥
        switch (e.Action)
        {
            case "move_left":
                MovePlayer(-1, 0);
                break;
            case "move_right":
                MovePlayer(1, 0);
                break;
            case "attack":
                Context.SendCommand(new AttackCommand());
                break;
        }
    }
    
    private void OnHealthChanged(int newHealth)
    {
        // æ›´æ–° UI
        var healthBar = GetNode<ProgressBar>("UI/HealthBar");
        healthBar.Value = newHealth;
        
        // æ’­æ”¾éŸ³æ•ˆ
        if (newHealth < _playerModel.PreviousHealth)
            PlayHurtSound();
    }
}
```

## Node æ‰©å±•æ–¹æ³•

GFramework.Godot æä¾›äº† 50+ ä¸ª Node æ‰©å±•æ–¹æ³•ï¼Œå¤§å¤§ç®€åŒ–äº† Godot å¼€å‘ä¸­çš„å¸¸è§æ“ä½œã€‚

### ğŸ” èŠ‚ç‚¹æŸ¥æ‰¾ä¸éªŒè¯

```csharp
// å®‰å…¨çš„èŠ‚ç‚¹è·å–
var player = GetNodeX<Player>("Player"); // è‡ªåŠ¨ null æ£€æŸ¥å’Œç±»å‹è½¬æ¢
var child = FindChildX<Player>("Player"); // é€’å½’æŸ¥æ‰¾å­èŠ‚ç‚¹

// èŠ‚ç‚¹éªŒè¯
if (IsValidNode(player))
{
    // èŠ‚ç‚¹æœ‰æ•ˆä¸”åœ¨åœºæ™¯æ ‘ä¸­
}

// å®‰å…¨çš„èŠ‚ç‚¹éå†
this.ForEachChild<Node>(child => {
    GD.Print($"Found child: {child.Name}");
});
```

### ğŸŒŠ æµç•…çš„åœºæ™¯æ ‘æ“ä½œ

```csharp
// å®‰å…¨çš„æ·»åŠ å­èŠ‚ç‚¹
var bullet = bulletScene.Instantiate<Bullet>();
AddChildX(bullet);

// ç­‰å¾…èŠ‚ç‚¹å‡†å¤‡å°±ç»ª
await bullet.WaitUntilReady();

// è·å–çˆ¶èŠ‚ç‚¹
var parent = GetParentX<GameLevel>();

// å®‰å…¨çš„èŠ‚ç‚¹ç§»é™¤
bullet.QueueFreeX(); // ç­‰æ•ˆäº QueueFree() ä½†å¸¦æœ‰éªŒè¯
bullet.FreeX(); // ç«‹å³é‡Šæ”¾ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
```

### ğŸ® è¾“å…¥å¤„ç†ç®€åŒ–

```csharp
// è¾“å…¥å¤„ç†
SetInputAsHandled(); // æ ‡è®°è¾“å…¥å·²å¤„ç†
DisableInput(); // ç¦ç”¨è¾“å…¥
EnableInput(); // å¯ç”¨è¾“å…¥

// è¾“å…¥çŠ¶æ€æ£€æŸ¥
if (Input.IsActionJustPressed("jump"))
{
    Jump();
}
```

### ğŸ”„ å¼‚æ­¥æ“ä½œæ”¯æŒ

```csharp
// ç­‰å¾…ä¿¡å·
await ToSignal(this, SignalName.Ready);

// ç­‰å¾…æ¡ä»¶æ»¡è¶³
await WaitUntil(() => IsReady);

// ç­‰å¾…å¸§ç»“æŸ
await WaitUntilProcessFrame();

// å»¶è¿Ÿæ‰§è¡Œ
await WaitUntilTimeout(2.0f);
```

## ä¿¡å·ç³»ç»Ÿ

### SignalBuilder æµç•… API

```csharp
using GFramework.Godot.extensions;

// åŸºç¡€ä¿¡å·è¿æ¥
this.ConnectSignal(Button.SignalName.Pressed, OnButtonPressed);

// æµç•…çš„ä¿¡å·æ„å»º
this.CreateSignalBuilder(Timer.SignalName.Timeout)
    .WithFlags(ConnectFlags.OneShot) // å•æ¬¡è§¦å‘
    .CallImmediately() // ç«‹å³è°ƒç”¨ä¸€æ¬¡
    .Connect(OnTimerTimeout)
    .UnRegisterWhenNodeExitTree(this);

// å¤šä¿¡å·è¿æ¥
this.CreateSignalBuilder()
    .AddSignal(Button.SignalName.Pressed, OnButtonPressed)
    .AddSignal(Button.SignalName.MouseEntered, OnButtonHover)
    .AddSignal(Button.SignalName.MouseExited, OnButtonExit)
    .UnRegisterWhenNodeExitTree(this);
```

### ä¿¡å·ä¸æ¡†æ¶äº‹ä»¶æ¡¥æ¥

```csharp
[ContextAware]
[Log]
public partial class UIController : Node, IController
{
    public override void _Ready()
    {
        // Godot ä¿¡å· -> æ¡†æ¶äº‹ä»¶
        this.CreateSignalBuilder(Button.SignalName.Pressed)
            .Connect(() => {
                Context.SendEvent(new UIButtonClickEvent { ButtonId = "start_game" });
            })
            .UnRegisterWhenNodeExitTree(this);
            
        // æ¡†æ¶äº‹ä»¶ -> Godot ä¿¡å·
        this.RegisterEvent<HealthChangeEvent>(OnHealthChanged)
            .UnRegisterWhenNodeExitTree(this);
    }
    
    private void OnHealthChanged(HealthChangeEvent e)
    {
        // æ›´æ–° Godot UI
        var healthBar = GetNode<ProgressBar>("HealthBar");
        healthBar.Value = e.NewHealth;
        
        // å‘é€ Godot ä¿¡å·
        EmitSignal(SignalName.HealthUpdated, e.NewHealth);
    }
    
    [Signal]
    public delegate void HealthUpdatedEventHandler(int newHealth);
}
```

## èŠ‚ç‚¹æ± åŒ–

### AbstractNodePoolSystem ä½¿ç”¨

```csharp
using GFramework.Godot.pool;

public class BulletPoolSystem : AbstractNodePoolSystem<string, Bullet>
{
    private PackedScene _bulletScene;
    
    public BulletPoolSystem()
    {
        _bulletScene = GD.Load<PackedScene>("res://scenes/Bullet.tscn");
    }
    
    protected override Bullet CreateItem(string key)
    {
        return _bulletScene.Instantiate<Bullet>();
    }
    
    protected override void OnSpawn(Bullet item, string key)
    {
        // é‡ç½®å­å¼¹çŠ¶æ€
        item.Reset();
        item.Position = Vector3.Zero;
        item.Visible = true;
    }
    
    protected override void OnDespawn(Bullet item)
    {
        // éšè—å­å¼¹
        item.Visible = false;
        // ç§»é™¤çˆ¶èŠ‚ç‚¹
        item.GetParent()?.RemoveChild(item);
    }
    
    protected override bool CanDespawn(Bullet item)
    {
        // åªæœ‰ä¸åœ¨ä½¿ç”¨ä¸­çš„å­å¼¹æ‰èƒ½å›æ”¶
        return !item.IsActive;
    }
}
```

### æ± åŒ–ç³»ç»Ÿä½¿ç”¨

```csharp
[ContextAware]
[Log]
public partial class WeaponController : Node, IController
{
    private BulletPoolSystem _bulletPool;
    
    protected override void OnInit()
    {
        _bulletPool = Context.GetSystem<BulletPoolSystem>();
    }
    
    public void Shoot(Vector3 direction)
    {
        // ä»æ± ä¸­è·å–å­å¼¹
        var bullet = _bulletPool.Spawn("standard");
        
        if (bullet != null)
        {
            // è®¾ç½®å­å¼¹å‚æ•°
            bullet.Direction = direction;
            bullet.Speed = 10.0f;
            
            // æ·»åŠ åˆ°åœºæ™¯
            GetTree().Root.AddChild(bullet);
            
            // æ³¨å†Œç¢°æ’æ£€æµ‹
            this.RegisterEvent<BulletCollisionEvent>(e => {
                if (e.Bullet == bullet)
                {
                    // å›æ”¶å­å¼¹
                    _bulletPool.Despawn(bullet);
                }
            }).UnRegisterWhenNodeExitTree(this);
        }
    }
}
```

## èµ„æºç®¡ç†

### ResourceLoadUtility ä½¿ç”¨

```csharp
using GFramework.Godot.assets;

[ContextAware]
[Log]
public partial class ResourceManager : Node, IController
{
    private ResourceLoadUtility _resourceLoader;
    
    protected override void OnInit()
    {
        _resourceLoader = new ResourceLoadUtility();
    }
    
    public T LoadResource<T>(string path) where T : Resource
    {
        return _resourceLoader.LoadResource<T>(path);
    }
    
    public async Task<T> LoadResourceAsync<T>(string path) where T : Resource
    {
        return await _resourceLoader.LoadResourceAsync<T>(path);
    }
    
    public void PreloadResources()
    {
        // é¢„åŠ è½½å¸¸ç”¨èµ„æº
        _resourceLoader.PreloadResource<Texture2D>("res://textures/player.png");
        _resourceLoader.PreloadResource<AudioStream>("res://audio/shoot.wav");
        _resourceLoader.PreloadResource<PackedScene>("res://scenes/enemy.tscn");
    }
}
```

### è‡ªå®šä¹‰èµ„æºå·¥å‚

```csharp
public class GameResourceFactory : AbstractResourceFactoryUtility
{
    protected override void RegisterFactories()
    {
        RegisterFactory<PlayerData>(CreatePlayerData);
        RegisterFactory<WeaponConfig>(CreateWeaponConfig);
        RegisterFactory<LevelData>(CreateLevelData);
    }
    
    private PlayerData CreatePlayerData(string path)
    {
        var config = LoadJson<PlayerConfig>(path);
        return new PlayerData
        {
            MaxHealth = config.MaxHealth,
            Speed = config.Speed,
            JumpForce = config.JumpForce
        };
    }
    
    private WeaponConfig CreateWeaponConfig(string path)
    {
        var data = LoadJson<WeaponJsonData>(path);
        return new WeaponConfig
        {
            Damage = data.Damage,
            FireRate = data.FireRate,
            BulletPrefab = LoadResource<PackedScene>(data.BulletPath)
        };
    }
}
```

## æ—¥å¿—ç³»ç»Ÿ

### GodotLogger ä½¿ç”¨

```csharp
using GFramework.Godot.logging;

[ContextAware]
[Log] // è‡ªåŠ¨ç”Ÿæˆ Logger å­—æ®µ
public partial class GameController : Node, IController
{
    public override void _Ready()
    {
        // ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ Logger
        Logger.Info("Game controller ready");
        
        try
        {
            InitializeGame();
            Logger.Info("Game initialized successfully");
        }
        catch (Exception ex)
        {
            Logger.Error($"Failed to initialize game: {ex.Message}");
        }
    }
    
    public void StartGame()
    {
        Logger.Debug("Starting game");
        
        // å‘é€æ¸¸æˆå¼€å§‹äº‹ä»¶
        Context.SendEvent(new GameStartEvent());
        
        Logger.Info("Game started");
    }
    
    public void PauseGame()
    {
        Logger.Info("Game paused");
        Context.SendEvent(new GamePauseEvent());
    }
}
```

### æ—¥å¿—é…ç½®

```csharp
public class GodotLoggerFactoryProvider : ILoggerFactoryProvider
{
    public ILoggerFactory CreateFactory()
    {
        return new GodotLoggerFactory(new LoggerProperties
        {
            MinLevel = LogLevel.Debug,
            IncludeTimestamp = true,
            IncludeCallerInfo = true
        });
    }
}

// åœ¨æ¶æ„åˆå§‹åŒ–æ—¶é…ç½®æ—¥å¿—
public class GameArchitecture : AbstractArchitecture
{
    protected override void Init()
    {
        // é…ç½® Godot æ—¥å¿—å·¥å‚
        LoggerProperties = new LoggerProperties
        {
            LoggerFactoryProvider = new GodotLoggerFactoryProvider(),
            MinLevel = LogLevel.Info
        };
        
        // æ³¨å†Œç»„ä»¶...
    }
}
```

## å®Œæ•´ç¤ºä¾‹

### ç®€å•å°„å‡»æ¸¸æˆç¤ºä¾‹

```csharp
// 1. å®šä¹‰æ¶æ„
public class ShooterGameArchitecture : AbstractArchitecture
{
    protected override void Init()
    {
        // æ³¨å†Œæ¨¡å‹
        RegisterModel(new PlayerModel());
        RegisterModel(new GameModel());
        RegisterModel(new ScoreModel());
        
        // æ³¨å†Œç³»ç»Ÿ
        RegisterSystem(new PlayerControllerSystem());
        RegisterSystem(new BulletPoolSystem());
        RegisterSystem(new EnemySpawnSystem());
        RegisterSystem(new CollisionSystem());
        
        // æ³¨å†Œå·¥å…·
        RegisterUtility(new StorageUtility());
        RegisterUtility(new ResourceLoadUtility());
    }
}

// 2. ç©å®¶æ§åˆ¶å™¨
[ContextAware]
[Log]
public partial class PlayerController : CharacterBody2D, IController
{
    private PlayerModel _playerModel;
    
    public override void _Ready()
    {
        _playerModel = Context.GetModel<PlayerModel>();
        
        // è¾“å…¥å¤„ç†
        SetProcessInput(true);
        
        // æ³¨å†Œäº‹ä»¶
        this.RegisterEvent<PlayerDamageEvent>(OnDamage)
            .UnRegisterWhenNodeExitTree(this);
    }
    
    public override void _Process(double delta)
    {
        var inputDir = Input.GetVector("ui_left", "ui_right", "ui_up", "ui_down");
        Velocity = inputDir * _playerModel.Speed.Value;
        MoveAndSlide();
    }
    
    public override void _Input(InputEvent @event)
    {
        if (@event.IsActionPressed("shoot"))
        {
            Shoot();
        }
    }
    
    private void Shoot()
    {
        if (CanShoot())
        {
            var bulletPool = Context.GetSystem<BulletPoolSystem>();
            var bullet = bulletPool.Spawn("player");
            
            if (bullet != null)
            {
                var direction = GetGlobalMousePosition() - GlobalPosition;
                bullet.Initialize(GlobalPosition, direction.Normalized());
                GetTree().Root.AddChild(bullet);
                
                Context.SendEvent(new BulletFiredEvent());
            }
        }
    }
    
    private void OnDamage(PlayerDamageEvent e)
    {
        _playerModel.Health.Value -= e.Damage;
        
        if (_playerModel.Health.Value <= 0)
        {
            Die();
        }
    }
    
    private void Die()
    {
        Logger.Info("Player died");
        Context.SendEvent(new PlayerDeathEvent());
        QueueFreeX();
    }
}

// 3. ä¸»åœºæ™¯
[ContextAware]
[Log]
public partial class MainScene : Node2D
{
    private ShooterGameArchitecture _architecture;
    
    public override void _Ready()
    {
        // åˆå§‹åŒ–æ¶æ„
        _architecture = new ShooterGameArchitecture();
        _architecture.Initialize();
        
        // åˆ›å»ºç©å®¶
        var playerScene = GD.Load<PackedScene>("res://scenes/Player.tscn");
        var player = playerScene.Instantiate<PlayerController>();
        AddChild(player);
        
        // æ³¨å†Œå…¨å±€äº‹ä»¶
        this.RegisterEvent<PlayerDeathEvent>(OnPlayerDeath)
            .UnRegisterWhenNodeExitTree(this);
            
        this.RegisterEvent<GameWinEvent>(OnGameWin)
            .UnRegisterWhenNodeExitTree(this);
            
        Logger.Info("Game started");
    }
    
    private void OnPlayerDeath(PlayerDeathEvent e)
    {
        Logger.Info("Game over");
        ShowGameOverScreen();
    }
    
    private void OnGameWin(GameWinEvent e)
    {
        Logger.Info("Victory!");
        ShowVictoryScreen();
    }
    
    private void ShowGameOverScreen()
    {
        var gameOverScene = GD.Load<PackedScene>("res://ui/GameOver.tscn");
        var gameOverUI = gameOverScene.Instantiate<Control>();
        AddChild(gameOverUI);
    }
    
    private void ShowVictoryScreen()
    {
        var victoryScene = GD.Load<PackedScene>("res://ui/Victory.tscn");
        var victoryUI = victoryScene.Instantiate<Control>();
        AddChild(victoryUI);
    }
}
```

## æœ€ä½³å®è·µ

### ğŸ—ï¸ æ¶æ„è®¾è®¡æœ€ä½³å®è·µ

#### 1. æ¨¡å—åŒ–è®¾è®¡

```csharp
// å¥½çš„åšæ³•ï¼šæŒ‰åŠŸèƒ½åˆ†ç»„æ¨¡å—
public class AudioModule : AbstractGodotModule { }
public class InputModule : AbstractGodotModule { }
public class UIModule : AbstractGodotModule { }

// é¿å…çš„åŠŸèƒ½è¿‡äºåºå¤§çš„å•ä¸€æ¨¡å—
public class GameModule : AbstractGodotModule // âŒ å¤ªå¤§
{
    // éŸ³é¢‘ã€è¾“å…¥ã€UIã€é€»è¾‘å…¨éƒ¨æ··åœ¨ä¸€èµ·
}
```

#### 2. ç”Ÿå‘½å‘¨æœŸç®¡ç†

```csharp
// å¥½çš„åšæ³•ï¼šä½¿ç”¨è‡ªåŠ¨æ¸…ç†
this.RegisterEvent<GameEvent>(OnGameEvent)
    .UnRegisterWhenNodeExitTree(this);

model.Property.Register(OnPropertyChange)
    .UnRegisterWhenNodeExitTree(this);

// é¿å…æ‰‹åŠ¨ç®¡ç†æ¸…ç†
private IUnRegister _eventRegister;
public override void _Ready()
{
    _eventRegister = this.RegisterEvent<GameEvent>(OnGameEvent);
}

public override void _ExitTree()
{
    _eventRegister?.UnRegister(); // å®¹æ˜“å¿˜è®°
}
```

### ğŸ® Godot é›†æˆæœ€ä½³å®è·µ

#### 1. èŠ‚ç‚¹å®‰å…¨æ“ä½œ

```csharp
// å¥½çš„åšæ³•ï¼šä½¿ç”¨å®‰å…¨æ‰©å±•
var player = GetNodeX<Player>("Player");
var child = FindChildX<HealthBar>("HealthBar");

// é¿å…çš„ç›´æ¥èŠ‚ç‚¹è®¿é—®
var player = GetNode<Player>("Player"); // å¯èƒ½æŠ›å‡ºå¼‚å¸¸
```

#### 2. ä¿¡å·è¿æ¥æ¨¡å¼

```csharp
// å¥½çš„åšæ³•ï¼šä½¿ç”¨ SignalBuilder
this.CreateSignalBuilder(Button.SignalName.Pressed)
    .UnRegisterWhenNodeExitTree(this)
    .Connect(OnButtonPressed);

// é¿å…çš„åŸå§‹æ–¹å¼
Button.Pressed += OnButtonPressed; // å®¹æ˜“å¿˜è®°æ¸…ç†
```

### ğŸŠâ€â™‚ï¸ æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

#### 1. èŠ‚ç‚¹æ± åŒ–ç­–ç•¥

```csharp
// å¥½çš„åšæ³•ï¼šé«˜é¢‘åˆ›å»ºå¯¹è±¡ä½¿ç”¨æ± åŒ–
public class BulletPool : AbstractNodePoolSystem<string, Bullet>
{
    // ä¸ºä¸åŒç±»å‹çš„å­å¼¹åˆ›å»ºä¸åŒçš„æ± 
}

// é¿å…çš„é¢‘ç¹åˆ›å»ºé”€æ¯
public void Shoot()
{
    var bullet = bulletScene.Instantiate(); // âŒ æ€§èƒ½é—®é¢˜
    // ...
    bullet.QueueFree();
}
```

#### 2. èµ„æºé¢„åŠ è½½

```csharp
// å¥½çš„åšæ³•ï¼šé¢„åŠ è½½å¸¸ç”¨èµ„æº
public override void _Ready()
{
    var resourceLoader = new ResourceLoadUtility();
    resourceLoader.PreloadResource<Texture2D>("res://textures/bullet.png");
    resourceLoader.PreloadResource<AudioStream>("res://audio/shoot.wav");
}
```

### ğŸ”§ è°ƒè¯•å’Œé”™è¯¯å¤„ç†

#### 1. æ—¥å¿—ä½¿ç”¨ç­–ç•¥

```csharp
// å¥½çš„åšæ³•ï¼šåˆ†çº§åˆ«è®°å½•
Logger.Debug($"Player position: {Position}"); // è°ƒè¯•ä¿¡æ¯
Logger.Info("Game started");                 // é‡è¦çŠ¶æ€
Logger.Warning($"Low health: {_playerModel.Health}"); // è­¦å‘Š
Logger.Error($"Failed to load resource: {path}");     // é”™è¯¯

// é¿å…çš„è¿‡åº¦æ—¥å¿—
Logger.Debug($"Frame: {Engine.GetProcessFrames()}"); // å¤ªé¢‘ç¹
```

#### 2. å¼‚å¸¸å¤„ç†

```csharp
// å¥½çš„åšæ³•ï¼šä¼˜é›…çš„é”™è¯¯å¤„ç†
public T LoadResource<T>(string path) where T : Resource
{
    try
    {
        return GD.Load<T>(path);
    }
    catch (Exception ex)
    {
        Logger.Error($"Failed to load resource {path}: {ex.Message}");
        return GetDefaultResource<T>();
    }
}
```

## æ€§èƒ½ç‰¹æ€§

### ğŸ“Š å†…å­˜ç®¡ç†

- **èŠ‚ç‚¹æ± åŒ–**ï¼šå‡å°‘ GC å‹åŠ›ï¼Œæé«˜é¢‘ç¹åˆ›å»º/é”€æ¯å¯¹è±¡çš„æ€§èƒ½
- **èµ„æºç¼“å­˜**ï¼šè‡ªåŠ¨ç¼“å­˜å·²åŠ è½½çš„ Godot èµ„æº
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šè‡ªåŠ¨æ¸…ç†äº‹ä»¶ç›‘å¬å™¨å’Œèµ„æºå¼•ç”¨

### âš¡ è¿è¡Œæ—¶æ€§èƒ½

- **é›¶åˆ†é…**ï¼šæ‰©å±•æ–¹æ³•é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ†é…
- **ç¼–è¯‘æ—¶ä¼˜åŒ–**ï¼šSource Generators å‡å°‘è¿è¡Œæ—¶å¼€é”€
- **ç±»å‹å®‰å…¨**ï¼šç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯

### ğŸ”„ å¼‚æ­¥æ”¯æŒ

- **ä¿¡å·ç­‰å¾…**ï¼šä½¿ç”¨ `await ToSignal()` ç®€åŒ–å¼‚æ­¥ä»£ç 
- **æ¡ä»¶ç­‰å¾…**ï¼š`WaitUntil()` å’Œ `WaitUntilTimeout()` ç®€åŒ–å¼‚æ­¥é€»è¾‘
- **åœºæ™¯æ ‘ç­‰å¾…**ï¼š`WaitUntilReady()` ç¡®ä¿èŠ‚ç‚¹å‡†å¤‡å°±ç»ª

---

## ä¾èµ–å…³ç³»

```mermaid
graph TD
    A[GFramework.Godot] --> B[GFramework.Game]
    A --> C[GFramework.Game.Abstractions]
    A --> D[GFramework.Core.Abstractions]
    A --> E[Godot.SourceGenerators]
    A --> F[GodotSharpEditor]
```

## ç‰ˆæœ¬å…¼å®¹æ€§

- **Godot**: 4.6
- **.NET**: 6.0+
- **GFramework.Core**: ä¸ Core æ¨¡å—ç‰ˆæœ¬ä¿æŒåŒæ­¥